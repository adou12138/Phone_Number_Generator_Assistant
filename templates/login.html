<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <title>登录 - 手机号码生成查询系统</title>
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- 
        登录页面模板
        
        功能说明：
        - 提供用户登录界面
        - 支持用户名和密码输入
        - 显示登录错误信息
        - 响应式设计，兼容移动端
        
        页面结构：
        1. 页面容器 - 居中显示登录框
        2. 标题区域 - 显示系统名称
        3. 登录表单 - 用户名、密码输入和登录按钮
        4. 错误提示区域 - 显示登录失败信息
        5. 底部版权信息
    -->
    
    <div class="container">
        <!-- 登录卡片 -->
        <div class="login-card">
            <!-- 标题区域 -->
            <div class="card-header">
                <h1>手机号码生成查询系统</h1>
                <p class="subtitle">请登录后使用</p>
            </div>
            
            <!-- 登录表单 -->
            <form id="loginForm" class="login-form">
                <!-- 用户名输入 -->
                <div class="form-group">
                    <label for="username">
                        用户名
                    </label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        placeholder="请输入用户名"
                        required
                        autocomplete="username"
                    >
                </div>
                
                <!-- 密码输入 -->
                <div class="form-group">
                    <label for="password">
                        密码
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        placeholder="请输入密码"
                        required
                        autocomplete="current-password"
                    >
                </div>
                
                <!-- 错误提示 -->
                <div id="errorMessage" class="error-message" style="display: none;">
                    <!-- 错误信息将通过JavaScript动态插入 -->
                </div>
                
                <!-- 登录按钮 -->
                <button type="submit" class="btn btn-primary btn-block">
                    登 录
                </button>
            </form>
            
            <!-- 底部信息 -->
            <div class="card-footer">
                <p>如需修改登录配置，请编辑 config.yaml 文件</p>
            </div>
        </div>
    </div>
    
    <!-- 引入JavaScript文件 -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- 页面特定脚本 -->
    <script>
        /**
         * 登录页面交互逻辑
         * 
         * 功能：
         * 1. 处理表单提交事件
         * 2. 发送登录请求到后端API
         * 3. 处理登录成功/失败响应
         * 4. 显示错误提示信息
         */
        
        document.addEventListener('DOMContentLoaded', function() {
            // 获取表单元素
            const loginForm = document.getElementById('loginForm');
            const errorMessage = document.getElementById('errorMessage');
            const submitBtn = loginForm.querySelector('button[type="submit"]');
            
            /**
             * 登录表单提交事件处理
             */
            loginForm.addEventListener('submit', function(e) {
                // 阻止表单默认提交行为
                e.preventDefault();
                
                // 获取输入值
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                
                // 基础验证
                if (!username || !password) {
                    showError('请输入用户名和密码');
                    return;
                }
                
                // 禁用提交按钮，防止重复提交
                submitBtn.disabled = true;
                submitBtn.textContent = '登录中...';
                hideError();
                
                // 发送登录请求
                fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        // 登录成功
                        showSuccess('登录成功，正在跳转...');
                        // 跳转到首页
                        setTimeout(function() {
                            window.location.href = data.redirect_url || '/';
                        }, 500);
                    } else {
                        // 登录失败
                        showError(data.message || '用户名或密码错误');
                        submitBtn.disabled = false;
                        submitBtn.textContent = '登 录';
                    }
                })
                .catch(error => {
                    // 网络错误
                    console.error('登录请求失败：', error);
                    showError('登录失败，请检查网络连接');
                    submitBtn.disabled = false;
                    submitBtn.textContent = '登 录';
                });
            });
            
            /**
             * 显示错误信息
             * @param {string} message - 错误消息
             */
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                errorMessage.classList.add('error');
            }
            
            /**
             * 隐藏错误信息
             */
            function hideError() {
                errorMessage.style.display = 'none';
                errorMessage.classList.remove('error');
            }
            
            /**
             * 显示成功信息
             * @param {string} message - 成功消息
             */
            function showSuccess(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                errorMessage.classList.remove('error');
                errorMessage.classList.add('success');
            }
        });
    </script>
</body>
</html>
